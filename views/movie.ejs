<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/styles/styles.css" />
    <link rel="stylesheet" href="/styles/stars_style.css" />
    <title><%= title %></title>
  </head>
  <body>
    <header>
      <nav class="nav-bar">
        <div class="logo">
          <span role="img">üçø</span>
          <h1>Movies</h1>
        </div>
        <div></div>
        <div class="auth">
          <a href="/followers">Followers</a><a href="/logout">Logout</a
          ><span>Jan</span>
        </div>
      </nav>
    </header>

    <main class="main">
      <div class="box">
        <a href="../" class="btn-back">x</a>
        <div class="details">
          <header>
            <img
              src="<%= movie.poster %>"
              alt="Poster of <%= movie.title %> movie"
            />
            <div class="details-overview">
              <h2><%= movie.title %></h2>
              <p><%= movie.year %> ‚Ä¢ <%= movie.runtime %></p>
              <p><%= movie.genre %></p>
              <p><span>‚≠ê</span><%= movie.imdbRating %> IMDb rating</p>
            </div>
          </header>
          <section>
            <div class="rating">
              <p>You rated this movie 8 ‚≠ê</p>
              <form id="rating-form">
                <div class="stars">
                  <div class="star-rating">
                    <input type="radio" id="star10" name="rating" value="10"/><label for="star10" title="10 stars">&#9733;</label>
                    <input type="radio" id="star9" name="rating" value="9"/><label for="star9" title="9 stars">&#9733;</label>
                    <input type="radio" id="star8" name="rating" value="8"/><label for="star8" title="8 stars">&#9733;</label>
                    <input type="radio" id="star7" name="rating" value="7"/><label for="star7" title="7 stars">&#9733;</label>
                    <input type="radio" id="star6" name="rating" value="6"/><label for="star6" title="6 star">&#9733;</label>
                    <input type="radio" id="star5" name="rating" value="5"/><label for="star5" title="5 stars">&#9733;</label>
                    <input type="radio" id="star4" name="rating" value="4"/><label for="star4" title="4 stars">&#9733;</label>
                    <input type="radio" id="star3" name="rating" value="3"/><label for="star3" title="3 stars">&#9733;</label>
                    <input type="radio" id="star2" name="rating" value="2"/><label for="star2" title="2 stars">&#9733;</label>
                    <input type="radio" id="star1" name="rating" value="1"/><label for="star1" title="1 star">&#9733;</label>
                  </div>
                </div>
                <button id="submit-rating" class="btn-add">+ Add to list</button>
              </form>
            </div>
            <p>
              <em><%= movie.plot %></em>
            </p>
            <p>Starring <%= movie.actors %></p>
            <p>Directed by <%= movie.director %></p>
          </section>
        </div>
      </div>
      <div class="box">
        <a href="../" class="btn-back">x</a>
        <div class="summary">
          <h2>Ratings from followers</h2>
          <div>
            <p><span>#Ô∏è‚É£</span><span>1</span></p>
            <p><span>‚≠êÔ∏è</span><span>8.2</span></p>
          </div>
        </div>
        <ul class="list">
          <li>
            <img
              src="https://static-00.iconduck.com/assets.00/profile-circle-icon-256x256-cm91gqm2.png"
              style="filter: invert(100%) brightness(2)"
              alt="Avatar"
            />
            <h3>Vojta Ra≈°ka</h3>
            <div>
              <p><span>üé¨</span><span>93</span></p>
              <p><span>‚≠êÔ∏è</span><span>8</span></p>
            </div>
          </li>
        </ul>
      </div>
    </main>

    <script>
      document.getElementById('rating-form').addEventListener('submit', function(event) {
        event.preventDefault();
  
        const formData = new FormData(this);
        const stars = formData.get('rating');
        const movieId = "<%= movie.id %>";
  
        if (stars) {
          saveRating(stars, movieId);
        } else {
          alert('Choose any rating!');
        }
      });
  
      function saveRating(stars, movieId) {
        fetch('/ratings/add', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ 
            stars: Number(stars),
            movieId: Number(movieId)
          }),
        })
        .then(response => {
          if (response.status === 201) {
            window.location.href = '/';
          } else {
            return response.json();
          }
        })
        .then(data => {
          if (data) {
            console.error('Server Error:', data);
          }
        })
        .catch((error) => {
          console.error('Error:', error);
        });
      }
    </script>
  </body>
</html>
